# 积性函数、莫比乌斯函数与莫比乌斯反演

## 数论函数

定义域为正整数、值域为复数（的子集）的函数称为积性函数。

有很多常见的数论函数。不想列举了反正后面会有。

## 积性函数

满足对于任意 $x \perp y$（数论中代表 $x$ 与 $y$ 互质，即 $(x,y)=1$，下同）都有 $f(xy)=f(x)f(y)$ 的数论函数称之为**积性函数**。

满足对于任意正整数 $x,y$（不要求互质）都有 $f(xy)=f(x)f(y)$ 的数论函数称之为**完全积性函数**。

比如 $f(x)=x,f(x)=x^2,f(x)=x^{114514},f(x)=\sqrt{x}$ 都是完全积性函数，而因数个数、因数和是积性函数（不是完全积性的），莫比乌斯函数（后面讲）也是积性的。

另一个好玩的积性函数是 $f(x)=[x=1]$，其中方括号是艾弗森括号（说真的，方括号在数学中表示的东西真的太多了。。），也就是 $f(x)=\begin{cases}1&x=1\\0&\text{otherwise}\end{cases}$。

### 性质

性质 $1$：积性函数 $f(x)$ 必须满足 $f(1)=1$ 或 $f(x)=0$。因为 $1\perp 1$，并且 $f(1\times 1)=f^2(1)$，所以 $f(1)=f^2(1)$，所以 $f(1)$ 为 $0$ 或 $1$。如果 $f(1)=0$，则因为任意 $x$ 都满足 $x \perp 1$，所以 $f(x)=f(x \times 1)=f(x)f(1)=0\square$。显然，零函数并不好玩。以下讨论的积性函数中没有零函数。

性质 $2$：对于积性函数 $f(x)$，知道所有形如 $f(p^a)$ 其中 $p$ 是质数 $a$ 是正整数，就可以确定 $f$ 的所有值了。证明：考虑质因数分解即可。$\square$

性质 $3$：对于完全积性函数 $f(x)$，知道所有质数的值就可以确定 $f$ 的所有值了。因为对 $f(p)$ 反复乘法可以得到所有 $f(p^a)$，然后利用性质 $1$ 可以得到结果。$\square$

性质 $4$：$f(x)$ 积性等价于 $g(x)=\displaystyle\sum_{d \mid x} f(d)$ 积性。

证明：

先证充分性。首先 $a \mid (xy)$ 等价于 $\exist b\mid x,c\mid y\text{ s.t }bc=a$。证明显然，略去。所以 $g(xy)$（$x \perp y$）为 $\displaystyle\sum_{d \mid (xy)}f(d)=\sum_{d_1\mid x}\sum_{d_2\mid y}f(d_1d_2)=\sum_{d_1\mid x}\sum_{d_2\mid y}f(d_1)f(d_2)=\left(\sum_{d_1\mid x}f(d_1)\right)\left(\sum_{d_2\mid y}f(d_2)\right)=g(x)g(y)$，证毕！

后证必要性。采用反证法（实际上差不多是数学归纳的另一种形式），如果存在一个 $a,b$ 满足 $a\perp b$ 且 $f(a)f(b)\neq f(ab)$，那么找到 $ab$ 最小的（有多个随便选一个）。那么 $g(ab)=\displaystyle\sum_{d \mid ab}f(d)=\displaystyle\sum_{x\mid a}\sum_{y\mid b}f(xy)\color{red}\neq\color{normal}\displaystyle\sum_{x\mid a}\sum_{y\mid b}f(x)f(y)=g(a)g(b)$。我们能够断言不等是因为只有 $x=a,y=b$ 时不等。这违反了 $g$ 是积性函数的性质，矛盾，证毕！

还有很多有趣的性质，但是这里先不多说了。

但是，性质 $4$ 比较有意思……我们知道了 $f$ 自然能够知道 $g$，但是知道了 $g$ 又怎么知道 $f$ 呢？我们先研究一个简单情况。

> 我们可以用性质 $4$ 证明 $\varphi$ 函数（因数个数）积性。

## 反用性质 $4$

### 简单情况 - 莫比乌斯函数

假设 $g(x)=[x=1]$。求 $f(x)$。

根据性质 $2$，我们只需要求 $f(p^n)$。我们知道当 $n\ge 2$ 时 $g(p^n)=g(p^{n-1})=0$，但是两者只差一个 $f(p^n)$，所以 $n \ge 2$ 时 $f(p^n)=0$。$n=1$ 时 $g(p)=0,g(p^0)=1$，所以 $f(p)=-1$。这样我们就能够知道 $f$ 的定义。将其命名为莫比乌斯函数 $\mu$（很多情况下被误写作 miu，但是实际上是 mu，但是输入法需要打 miu 才能打出来）：

$$ \mu(n)=\begin{cases}(-1)^k&n=p_1p_2p_3\dots p_k,p_i\text{ 两两不同}\\0&\text{otherwise}\end{cases} $$

### 莫比乌斯反演

研究一般情况下怎么做。同样研究 $f(p^n)$。我们同样使用 $g(p^n)$ 和 $g(p^{n-1})$，得到 $f(p^n)=g(p^n)-g(p^{n-1})$，乘起来得到 $f(x)=\displaystyle\prod_{i=1}^k g({p_i}^{\alpha_i})-g({p_i}^{\alpha_i-1})$。这并不好看啊？考虑将其展开以得到一个美观的形式。注意到展开后只会出现 $g(d)$ 满足 $d$ 的质因子分解的每个次数和 $x$ 的都最多差 $1$，也就是 $\mu\left(\dfrac{x}{d}\right)\neq 0$，并且其符号就是 $\mu\left(\dfrac{x}{d}\right)$！（感叹号不是阶乘），所以得到 $f(x)=\displaystyle\sum_{d\mid x} \mu\left(\dfrac{x}{d}\right)g(d)$，好看吧！

这就是听起来非常困难的莫比乌斯反演。它有什么用？原本那个式子不是很利于筛法求值，但是转化后的式子可以！$\mu$ 函数也是可以筛法求的（可能筛法需要换一个名字了，它是用来求质数的吗 qwq）。
