# 浅谈模意义下的乘法逆元

## 定义

给定 $a,p$，求一个 $b \in [0,p)$，满足 $ab\equiv 1\pmod p$。

$b$ 称作 $a$ 在模 $p$ 意义下的乘法逆元（数论倒数）。在模数可以由上下文得知的时候可以写成 $a$ 的逆元，记作 $a^{-1}$

不一定存在，显然 $(a,p)>1$ 就必然不存在。而根据完全剩余系性质，显然当 $(a,p)=1$ 时存在且唯一。

## 质数模数单次询问

$p$ 为质数，一次询问。

如果 $a$ 是 $p$ 的倍数则不存在。否则：

注意到！费马小定理有 $a^{p-1}\equiv 1\pmod p$，所以 $a^{p-2}\times a\equiv 1\pmod p$。故乘法逆元为 $a^{p-2}$。

快速幂做到 $\mathcal O(\log p)$ 复杂度。

## 模数常数单次询问

模数可能不是质数了！但是是常数。怎么做？注意到欧拉定理：$a^{\varphi(p)}\equiv 1\pmod p$（简化剩余系可证），所以同样地乘法逆元为 $a^{\varphi(p)-1}$。我本来可以用感叹号的但是可能会被认为是阶乘。混凝土数学中写“……式 $(5.23)$！”就被人批注 $(5.23)!=(5.23)(4.23)(3.23)(2.23)(1.23)(0.23)!$（我忘了是不是 $5.23$ 了）。

## 单次询问

额可能更加困难了，毕竟计算欧拉函数是根号级别的。但是我们不妨换一种角度想：模线性同余方程就是一个二元一次不定方程。所以 exgcd 解即可。

具体地，$ab\equiv 1\pmod p$ 相当于 $ab=cp+1$，也就是 $ab-cp=1$，然后 exgcd 求 $b,c$ 即可（实际上不需要求 $c$，但是 exgcd 需要）。

## 模数为质数时给定上限的正整数

分别求 $[1,n]$ 的乘法逆元。直接求是 $\mathcal O(n \log p)$ 的。有没有线性！

递推？递推！顺推？倒推？奇怪的阶乘？

### 顺推

我们考虑 $p \div i$ 时的商 $k$ 和余数 $r$。$p=ki+r$。那么 $ki+r\equiv 0\pmod p$。

这个式子有什么用？无论我往左边乘上什么奇奇怪怪的东西右边都是 $0$。只要保证那些东西存在。

所以如果我们要求 $i^{-1}$，那么如果把 $ki$ 搞出这个东西那么要乘两次 $i^{-1}$，感觉不好做。把 $r$ 变为那个？那就乘上 $r^{-1}i^{-1}$。所以得到 $kr^{-1}+i^{-1}\equiv 0\pmod p$，也就是 $i^{-1}\equiv -kr^{-1}\pmod p$，而显然 $r<i$，就能够得到结果了。复杂度为 $\mathcal O(n)$！

### 连续阶乘逆元

注意到！$i=\dfrac{i!}{(i-1)!}$。所以我们求出所有的 $n!\bmod p$ 和 $(n!)^{-1}$ 就好了！求后面两个东西可以倒推！先顺推求出所有的阶乘然后费马小定理求出 $(n!)^{-1}$ 然后每次乘上 $i$ 即可！复杂度为 $\mathcal O(n+\log p)$！

不过，如果 $n=p-1$，我们可以继续优化！虽然时间复杂度已经是最优的了。如果你知道威尔逊定理你就会知道 $(p-1)!\equiv -1\pmod p$！可以省去一次逆元！

## 普通的多组数据

仿照阶乘的方法？我们有 $a_1,a_2,\cdots,a_n$ 要分别求逆元。高效做法？

设 $M=a_1a_2a_3\cdots a_n$
