# 浅谈快速傅里叶变换（FFT）及其逆变换（IFFT）

## 前置知识

- 多项式的基本定义以及加、减、乘。
- 复数与单位根相关内容，包括但不限于欧拉公式 $e^{i\theta}=\cos\theta+i\sin\theta$。

## 引入——多项式乘法

典中典的引入了属于是。

对两个多项式进行乘法。大家都会吧？就像对两个多位数乘法一样简单，只是没有进位而已。我对多项式的理解之一就是可变进制的数字。本质上这样乘法就是多次运用分配律。

然而，如果我们换种写法，会更简单！

如果我们知道两个 $n$ 次多项式（如果次数不同可以补零，不管这些细节）$F$ 和 $G$ 在 $n+1$ 个不同的点（$x_1,x_2,\dots,x_{n+1}$）处分别的取值（$F(x_1),F(x_2),\dots,F(x_{n+1})$ 和 $G(x_1),G(x_2),\dots,G(x_{n+1})$），对其进行乘法，是不是能得到 $F\cdot G$ 在这 $n+1$ 个点处的取值呢？

显然这是对的，但是我们根据这个也无法还原出 $F\cdot G$ 的系数了。$F\cdot G$ 是 $2n$ 次多项式，需要 $2n$ 个点。解决方法也很简单，选取 $F$ 和 $G$ 在 $2n+1$ 个不同点处的取值即可。时间复杂度是 $\Theta(n)$ 的……且慢。

首先我给你的多项式是系数表示，不是在这些点处的取值。然后我们得到在这些点处的取值之后还要还原回系数表示，这个复杂度……

我们先解决第一个问题（求值）。实际上这并不是那么好解决的。我们需要 $\Theta(n)$ 的时间对一个多项式在一个点处的值进行计算，然后需要计算 $\Theta(n)$ 个点的值，所以复杂度是 $\Theta(n^2)$……这不好。

关于“还原”的时间复杂度，其实这个是插值的过程，拉格朗日插值可以做到 $\Theta(n^2)$……好的，又炸了。

剧透一下，这个时候我们就需要通过一些巧妙的选点方式快速计算出结果了。如果对这些巧妙的选点进行直接计算则会有很多的重复计算，FFT 和 IFFT 就是通过减少这些重复计算来快速获取结果的。

## FFT

言归正传，我们先解决求值。也就是说，我们给定一个多项式 $F$，次数为 $n$，我们可以自由地选取 $2n+1=k=Theta(n)$ 个数字 $x_1,x_2,\dots,x_k$，两两不同，并且求得 $F(x_1),F(x_2),\dots,F(x_k)$ 的值。

我们想：

1. 如果 $F$ 是奇函数，那么我们可以偷一下懒，减少一半的工作量——如果 $x\neq 0$，那么只需要计算 $F(x)$ 就能知道 $F(-x)$ 了。如果偶函数也可以这么干。问题是，这样偷懒之后还是得正常算，我们不知道更多信息——其实不是。如果 $F$ 是偶函数，说明所有系数非零的项次数都是偶数，也就是有另一个多项式 $G$，满足 $F(x)=G(x^2)$——这个 $G$ 就是 $F$ 所有的项的次数减半的结果。同时，如果是奇函数，那么必然有 $G$ 满足 $F(x)=xG(x^2)$，显然就是次数减一再减半的结果。也就是，我们只需要求出这个 $G$ 的 $\dfrac{k}{2}$ 个结果即可。
2. 如果我们知道 $F=G+H$，其中我们知道 $G(x_1,x_2,\dots,x_k)$ 和 $H(x_1,x_2,\dots,x_k)$，那么我们显然能够知道 $F$ 的结果。

接下来，注意！提取 $F$ 的奇数次项和偶数次项，显然它们分别是奇函数和偶函数，然后按照上面的第一条求值计算，然后按照第二条合并即可！时间复杂度满足 $T(n)=2T\left(\dfrac{n}{2}\right)+\Theta(n)$，也就是 $T(n)=\Theta(n\log n)$！同时，因为每次选择一半的项，所以 $k$ 最好取 $2$ 的幂，不够补齐。

还有一个遗留的细节没有解决，就是怎么样让 $G,H$ 选取的点相同？仔细看一下，我们要知道 $F(x)$ 实际上就是要知道 $G(x^2)$，以此类推。这样，我们就需要刚开始 $k$ 个数字，然后平方之后变为 $\dfrac{k}{2}$ 个不同的，然后平方之后变为 $\dfrac{k}{4}$ 个不同的……且慢，一次平方之后就都是正数了，这样再平方就不会出现重复了！

好在数学中还有一类除了不能比较大小（实际上可以，但是需要借助与尚有争议的选择公理等价的良序定理，并且这样比较的大小没有什么意义）之外和实数性质几乎一样好，甚至更好的数字——复数。我们发现，负数平方是正数，而纯虚数平方后是负数，纯虚数也可以开方，并且有两个根！这两个平方之后得到纯虚数，然后下去……

最终我们能够得到什么？刚开始的那些数字是什么？

为了方便，我们不妨假设最后所有的数聚集在 $1$。那么，每个数字都经历了 $\log_2k$ 次平方，也就是相当于变为了 $k$ 次方——也就是 $1$ 的 $k$ 个 $k$ 次方根。这就是单位根 $\omega_k=e^{\frac{2\pi\mathrm i}{k}}$！$\omega_k$ 的 $0,1,2,3,\dots,k-1$ 次幂就是 $x^k=1$ 的所有 $k$ 个解，也就是我们得到的结果。

怎么样，很自然吧！

### 递归版（分治）

我们递归地模拟上面的过程。代码如下：

```cpp

```
