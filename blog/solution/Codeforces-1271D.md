# CF-1271D 题解

不是很难，为啥是蓝。

首先显然派兵只派一个（update：洛谷翻译问题。实际上 cf 上说了只能派一个）。然后因为一个城堡有多次派兵驻守的机会，而先驻守并没有什么好处（甚至可能后面的城堡占领不了了），所以规定每个城堡只能最后派兵驻守。第 $i$ 个城堡最后的驻守机会位于第 $e_i$ 个城堡。

那么考虑套路性的状态设计。显然 $f_{i,j}$ 为考虑前 $i$ 个城堡，考虑完毕后还剩下 $j$ 个士兵的最大得分（不到最后时刻，一定不能派兵驻守某个城堡）。令 $S=k+\sum b$，则状态数是 $\mathcal O(nS)$ 的，而 $S \le 5000$ 可以接受。考虑状态转移？

显然我们状态转移的第一个思路是，对于所有 $e_k=i$ 的 $k$ 组成的集合 $f_e$，考虑在能够接受的情况下能够获得的最大值。但是这样并不怎么可行，因为我们每次状态转移要处理 $\lvert f_e \rvert$ 个状态，太多了。所以其实我们需要更快的状态转移。
